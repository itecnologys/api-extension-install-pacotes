â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ARQUITETURA VISUAL SIMPLIFICADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                        ğŸŒ INTERNET
                            â”‚
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 95.216.14.146  â”‚ â† IP PÃºblico (Hetzner)
                    â”‚  (Proxmox)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          ğŸ”¥ PFSENSE                          â”‚
                    â”‚      (Firewall/Gateway)                      â”‚
                    â”‚                                               â”‚
                    â”‚  ğŸ“ IP WAN: 10.0.0.2                        â”‚
                    â”‚  ğŸ“ IP LAN: 10.10.10.1 (Gateway)            â”‚
                    â”‚                                               â”‚
                    â”‚  ğŸ”€ PORT FORWARDS:                           â”‚
                    â”‚    80/443 â†’ Traefik                         â”‚
                    â”‚    25/465/587/993/995 â†’ Carbonio            â”‚
                    â”‚                                               â”‚
                    â”‚  ğŸ›¡ï¸  SNORT (IDS/IPS)                        â”‚
                    â”‚     Whitelist: Traefik + Carbonio            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Rede: 10.10.10.0/24
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ³ TRAEFIK    â”‚                    â”‚  ğŸ“§ CARBONIO    â”‚
â”‚  VM 105        â”‚                    â”‚  VM 108        â”‚
â”‚                â”‚                    â”‚                â”‚
â”‚ IP: 10.10.10.  â”‚                    â”‚ IP: 10.10.10.  â”‚
â”‚     105        â”‚                    â”‚     108        â”‚
â”‚                â”‚                    â”‚                â”‚
â”‚ Portas:        â”‚                    â”‚ Portas:        â”‚
â”‚ â€¢ 8055 (HTTP)  â”‚                    â”‚ â€¢ 80 (HTTP)    â”‚
â”‚ â€¢ 9055 (HTTPS) â”‚                    â”‚ â€¢ 443 (HTTPS)  â”‚
â”‚                â”‚                    â”‚ â€¢ 25 (SMTP)    â”‚
â”‚ FunÃ§Ã£o:        â”‚                    â”‚ â€¢ 465 (SMTPS)  â”‚
â”‚ Reverse Proxy  â”‚                    â”‚ â€¢ 587 (SMTP-TLSâ”‚
â”‚ SSL/TLS        â”‚                    â”‚ â€¢ 993 (IMAPS)  â”‚
â”‚ Let's Encrypt  â”‚                    â”‚ â€¢ 995 (POP3S)  â”‚
â”‚                â”‚                    â”‚                â”‚
â”‚ Roteia:        â”‚                    â”‚ ServiÃ§os:      â”‚
â”‚ mail.ligbox... â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ Webmail      â”‚
â”‚   â†’ Carbonio   â”‚                    â”‚ â€¢ SMTP/IMAP    â”‚
â”‚                â”‚                    â”‚ â€¢ CalDAV       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â€¢ CardDAV      â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        FLUXO DE TRÃFEGO WEB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cliente Externo
      â”‚
      â”‚ HTTPS:443 ou HTTP:80
      â”‚ mail.ligbox.com.br
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INTERNET       â”‚
â”‚  95.216.14.146  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PFSENSE        â”‚
â”‚  Port Forward:  â”‚
â”‚  443â†’105:9055   â”‚
â”‚  80â†’105:8055    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Rede Interna
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRAEFIK        â”‚
â”‚  â€¢ SSL/TLS      â”‚
â”‚  â€¢ Certificado  â”‚
â”‚  â€¢ Roteamento   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTPS interno
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CARBONIO       â”‚
â”‚  â€¢ Webmail      â”‚
â”‚  â€¢ NGINX        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                      FLUXO DE TRÃFEGO EMAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cliente Email
      â”‚
      â”‚ SMTP/IMAP/POP3
      â”‚ Portas: 25, 465, 587, 993, 995
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INTERNET       â”‚
â”‚  95.216.14.146  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PFSENSE        â”‚
â”‚  Port Forward:  â”‚
â”‚  25â†’108:25      â”‚
â”‚  465â†’108:465    â”‚
â”‚  587â†’108:587    â”‚
â”‚  993â†’108:993    â”‚
â”‚  995â†’108:995    â”‚
â”‚                 â”‚
â”‚  âš ï¸ DIRETO!     â”‚
â”‚  (bypass Traefik)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Rede Interna
         â”‚ ConexÃ£o Direta
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CARBONIO       â”‚
â”‚  â€¢ SMTP Server  â”‚
â”‚  â€¢ IMAP Server  â”‚
â”‚  â€¢ POP3 Server  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        EXPLICAÃ‡ÃƒO DAS CONEXÃ•ES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”µ CONEXÃƒO 1: Internet â†’ pfSense
   â””â”€> Cliente externo acessa IP pÃºblico 95.216.14.146
   â””â”€> TrÃ¡fego chega no pfSense (firewall/gateway)
   â””â”€> pfSense verifica regras de firewall

ğŸ”µ CONEXÃƒO 2: pfSense â†’ Traefik (Web)
   â””â”€> Port Forward: 443 externa â†’ 10.10.10.105:9055
   â””â”€> Port Forward: 80 externa â†’ 10.10.10.105:8055
   â””â”€> Traefik recebe trÃ¡fego web (HTTP/HTTPS)
   â””â”€> Traefik processa SSL/TLS e certificados

ğŸ”µ CONEXÃƒO 3: Traefik â†’ Carbonio (Web)
   â””â”€> Traefik roteia baseado em Host header
   â””â”€> mail.ligbox.com.br â†’ 10.10.10.108:443
   â””â”€> ConexÃ£o HTTPS interna
   â””â”€> Carbonio responde com webmail

ğŸ”µ CONEXÃƒO 4: pfSense â†’ Carbonio (Email)
   â””â”€> Port Forwards diretos (bypass Traefik)
   â””â”€> 25, 465, 587, 993, 995 â†’ 10.10.10.108
   â””â”€> Email nÃ£o passa pelo Traefik (performance)
   â””â”€> Carbonio processa email diretamente

ğŸ”µ CONEXÃƒO 5: Snort â†’ Monitoramento
   â””â”€> Snort monitora todo trÃ¡fego (WAN e LAN)
   â””â”€> Whitelist evita bloqueios falsos
   â””â”€> Traefik e Carbonio na Pass List

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        POR QUE ESTA ARQUITETURA?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… SEPARAÃ‡ÃƒO DE RESPONSABILIDADES
   â€¢ Traefik = Web (SSL, certificados, roteamento)
   â€¢ Carbonio = Email (SMTP, IMAP, webmail)
   â€¢ pfSense = SeguranÃ§a (firewall, NAT, monitoramento)

âœ… PERFORMANCE
   â€¢ Email direto (sem latÃªncia do Traefik)
   â€¢ Traefik otimizado para SSL/TLS
   â€¢ Cada serviÃ§o na sua especialidade

âœ… SEGURANÃ‡A
   â€¢ Snort monitora tudo
   â€¢ Firewall controla acesso
   â€¢ Whitelist evita bloqueios

âœ… MANUTENÃ‡ÃƒO
   â€¢ Certificados automÃ¡ticos (Traefik)
   â€¢ Logs centralizados
   â€¢ FÃ¡cil troubleshooting

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

